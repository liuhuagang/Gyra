# UE5_Lyra学习指南_119_集合去重代码

本文章仅为小刚-B站课堂-虚幻引擎视频课程Lyra-精讲的演讲手稿.  
本套课程链接:[[UE5]虚幻引擎游戏案例Lyra精讲](https://www.bilibili.com/cheese/play/ss112001159)  
前置课程链接:[[UE5]虚幻引擎UEC++从基础到进阶](https://www.bilibili.com/cheese/play/ss28043)  

文章内容由小刚撰写,采用了以下多种方式:  
1.口述转文字  
2.AI重构  
3.参考引擎源码  
4.Lyra工程源码  
5.结合社区论坛各位大佬的解析  

- [UE5\_Lyra学习指南\_119\_集合去重代码](#ue5_lyra学习指南_119_集合去重代码)
	- [概述](#概述)
	- [主要功能](#主要功能)
	- [命令参数](#命令参数)
	- [工作流程](#工作流程)
		- [1.获取集合资产](#1获取集合资产)
		- [2.计算新增资产](#2计算新增资产)
		- [3.递归分析依赖关系](#3递归分析依赖关系)
		- [4.生成分析报告](#4生成分析报告)
			- [A.支持者列表（按支持数量排序）](#a支持者列表按支持数量排序)
			- [B.未支持的资产列表](#b未支持的资产列表)
	- [使用场景示例](#使用场景示例)
	- [技术特点](#技术特点)
	- [总结](#总结)



## 概述
这段代码定义了一个名为 `Lyra.DiffCollectionReferenceSupport` 的虚幻引擎控制台命令，用于分析两个资产集合（Collection）之间的依赖关系，具体功能是：

## 主要功能
比较两个集合，找出新集合（NewCollection）中哪些新增资产被旧集合（OldCollection）中的资产所引用（支持）

## 命令参数
```
Lyra.DiffCollectionReferenceSupport OldCollectionName NewCollectionName [Deduplicate]
```
- `OldCollectionName`: 旧集合名称
- `NewCollectionName`: 新集合名称  
- `Deduplicate` (可选): 是否对多重支持的资产进行去重（默认true）

## 工作流程
### 1.获取集合资产
- 从指定名称的集合中获取所有资产路径
- 分别得到旧集合(`OldPaths`)和新集合(`NewPaths`)

### 2.计算新增资产
- 找出新集合中存在但旧集合中不存在的资产（`IntroducedAssetSet`）
### 3.递归分析依赖关系
- 对每个新增资产，递归查找其引用者（`Referencers`）
- 如果引用者来自旧集合，建立直接支持关系
- 如果引用者来自其他资产，继续递归查找，建立间接支持关系
### 4.生成分析报告
#### A.支持者列表（按支持数量排序）
- 列出旧集合中支持新增资产的资产
- 显示每个支持者支持的新资产数量
- 标记哪些资产是"多重支持"的（被多个旧资产引用）
- 可选择是否去重显示多重支持的资产

#### B.未支持的资产列表
- 列出新增资产中没有被任何旧集合资产引用的资产
## 使用场景示例
假设有两个集合：
- `Collection_Base`: 基础资产集合
- `Collection_Update`: 更新后的资产集合

运行命令后，可以知道：
1. 新增了哪些资产（`Collection_Update`中有但`Collection_Base`中没有）
2. 新增资产中哪些被基础资产引用（有依赖关系）
3. 哪些新增资产是孤立的（没有依赖关系）

## 技术特点
- 使用虚幻引擎的资产注册表（`IAssetRegistry`）查询依赖关系
- 支持递归依赖分析
- 使用集合（`TSet`）和映射（`TMap`）高效处理数据
- 提供可选的去重功能，避免重复统计

这个工具在游戏开发中很有用，特别是：
- 检查资产更新是否会影响现有内容
- 识别孤立的或未使用的资产
- 理解资产间的依赖关系网络
## 总结
该文档由DeepSeek阅读代码生成.